<% @ad = Sys::Setting.first %>
<% if @ad.try(:files).present? %>
  <%
    width = @ad.width ? @ad.width.to_i : 360
    time = @ad.time ? @ad.time.to_i : 3
  %>
  <script>
  $(function(){
    $('.bxslider').bxSlider({
      auto: true,
      slideWidth: <%= width %>,
      pause: <%= time * 1000 %>,
      mode: 'horizontal',
      touchEnabled: false
    });
  });
  </script>
  <div class="main-box login-ad">
    <header>
      <h2><%= t('sys.login.ad') %></h2>
    </header>
    <ul class="bxslider">
      <% @ad.files.shuffle.each do |file| %>
        <% contents = capture do %>
          <% if file.try(:image) %>
            <% if file.link_url.present? %>
              <%= link_to image_tag(file.image.url, width: width), sns_redirect_path(ref: file.link_url, back_to: request.url), target: "_blank", rel: "noopener" %>
            <% else %>
              <%= link_to image_tag(file.image.url, width: width), "#" %>
            <% end %>
          <% elsif file.try(:image?) %>
            <% if file.link_url.present? %>
              <%= link_to image_tag(file.url, width: width), sns_redirect_path(ref: file.link_url, back_to: request.url), target: "_blank", rel: "noopener" %>
            <% else %>
              <%= link_to image_tag(file.url, width: width), "#" %>
            <% end %>
          <% end %>
        <% end %>
        <% if contents %>
          <li><%= contents %></li>
        <% end %>
      <% end %>
    </ul>
  </div>
<% end %>
